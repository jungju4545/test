package chat2;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Scanner;

public class SocketServer {

	ServerSocket serverSocket = null; //스트림 연결 소켓
	Socket socket = null; //채팅을 실질적으로 하는 소켓
	BufferedReader reader = null; //받는 것
	PrintWriter writer = null;

	
	public SocketServer() {
		try {
			//서버소켓 생성
			serverSocket = new ServerSocket(10000); 
			
			//클라이언트로 부터 접속 대기
			System.out.println("클라이언트로 부터 접속 대기중.");
			socket = serverSocket.accept(); //아래 코드 실행 안됨.
			System.out.println("요청이 성공함.");
			
			//System.in(키보드요청), con.getInputStream(), socket.getInputStream()
			reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
			writer = new PrintWriter(socket.getOutputStream());
			
			Thread t1 = new Thread(new WriterThread());
			t1.start();
			
			String line = null;
			//메인 쓰레드 역할
			while((line = reader.readLine()) != null) {
				System.out.println("클라이언트부터 온 메시지 : "+line);
			}
			
			//종료는 프로그램을 끄면 됨.
			reader.close();
			socket.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	class WriterThread implements Runnable {
		@Override
		public void run() {
			Scanner sc = new Scanner(System.in);
			while(true) {
				String line = sc.nextLine();
				writer.println(line);
				writer.flush();
			}
		}
	}
	
	public static void main(String[] args) {
		new SocketServer();
	}

}
